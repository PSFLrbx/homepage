<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Player Stats Page</title>
  <!-- Papaparse for CSV parsing -->
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.3.2/papaparse.min.js"></script>
  <style>
    body {
      font-family: 'IBM Plex Sans', sans-serif;
      background: #111;
      color: #fff;
      margin: 0; 
      padding: 20px;
    }
    /* Basic container styling */
    .stats-container {
      background: rgba(34,34,34,0.85);
      padding: 1rem;
      border-radius: 4px;
      max-width: 90%;
      margin: 0 auto;
    }
    h1 {
      text-align: center;
      margin-bottom: 1rem;
    }
    .heading-row, .player-row {
      display: grid;
      grid-template-columns: 60px repeat(4, 1fr); /* Example: 1 rank col + 4 data cols */
      gap: 5px;
      align-items: center;
      padding: 10px;
      border-radius: 5px;
      margin-bottom: 5px;
    }
    .heading-row {
      background: rgba(0,0,0,0.7);
      font-weight: bold;
    }
    .player-row {
      background: rgba(0,0,0,0.5);
      box-shadow: 0 2px 4px rgba(0,0,0,0.5);
    }
    .heading-cell, .player-cell {
      padding: 0 10px;
      text-align: left;
    }
    .heading-cell.rank-cell, .player-rank {
      width: 60px;
      text-align: center;
    }
    .player-rank {
      font-weight: bold;
      background: #000;
      border-radius: 5px;
    }
  </style>
</head>
<body>

  <h1>QB Stats</h1>
  <div class="stats-container" id="qb-container">
    <!-- Rows get inserted here by JS -->
  </div>

  <script>
    // 1) Define your CSV link
    const CSV_QB_LINK = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQv20vUSyozLzoZmyfQGHiPHx0JNlnZoZlGxa6K9ZjdCPhHdjWXb8ToDvebBaxRz3CJfWPjj0bI18Zy/pub?output=csv";

    // 2) On DOM load, fetch the CSV and build the table
    document.addEventListener('DOMContentLoaded', () => {
      fetchAndBuildList(CSV_QB_LINK, "qb-container");
    });

    /**
     * fetchAndBuildList:
     * - Fetches the CSV from 'csvLink'
     * - Parses it with PapaParse
     * - Dynamically builds a "table" using divs.
     */
    function fetchAndBuildList(csvLink, containerId) {
      fetch(csvLink)
        .then(response => response.text())
        .then(csvText => {
          const results = Papa.parse(csvText, { header: true, skipEmptyLines: true });
          const data = results.data;
          const fields = results.meta.fields; // e.g. ["Usernames", "PassYds", "TDs", ...]
          buildTable(fields, data, containerId);
        })
        .catch(err => console.error("Error fetching CSV:", err));
    }

    /**
     * buildTable:
     * - Creates a heading row from 'fields'
     * - Creates a row for each record in 'data'
     */
    function buildTable(fields, data, containerId) {
      const container = document.getElementById(containerId);
      container.innerHTML = ""; // Clear out any existing content

      // Make a heading row
      const headingRow = document.createElement("div");
      headingRow.classList.add("heading-row");
      // Blank rank cell
      const rankHeading = document.createElement("div");
      rankHeading.classList.add("heading-cell", "rank-cell");
      rankHeading.textContent = "Rank";
      headingRow.appendChild(rankHeading);

      // Field headings
      fields.forEach(f => {
        const cell = document.createElement("div");
        cell.classList.add("heading-cell");
        cell.textContent = f;
        headingRow.appendChild(cell);
      });
      container.appendChild(headingRow);

      // Data rows
      data.forEach((row, i) => {
        const rowDiv = document.createElement("div");
        rowDiv.classList.add("player-row");

        // Rank cell
        const rankDiv = document.createElement("div");
        rankDiv.classList.add("player-rank");
        rankDiv.textContent = i + 1; // 1-based rank
        rowDiv.appendChild(rankDiv);

        // Data cells
        fields.forEach(f => {
          const cellDiv = document.createElement("div");
          cellDiv.classList.add("player-cell");
          cellDiv.textContent = row[f] || ""; // Show CSV value
          rowDiv.appendChild(cellDiv);
        });

        container.appendChild(rowDiv);
      });
    }
  </script>
</body>
</html>
